# Word文档拆分功能使用文档

## 功能概述

该功能允许您将一个大型Word文档（.docx格式）按指定的页数拆分成多个XML文件，便于分批处理和管理。

### 主要特性

- **灵活的页数设置**：可自定义每个XML文件包含的页数（默认30页）
- **智能分页识别**：自动识别Word文档中的分页符
- **段落估算**：当文档没有明确分页符时，按段落数量智能估算
- **分页预览**：支持左右切换查看每个拆分后的XML
- **灵活下载**：可单独下载当前XML，或打包下载所有XML为zip文件

## 使用步骤

### 1. 上传Word文档

在"AI文档分析"页面的"文档上传"区域：
- 拖放Word文档（.docx格式）到上传区域
- 或点击"选择文件"按钮手动选择

### 2. 设置拆分参数

在"DOCX转XML测试"区域的"文档拆分功能"部分：
- 在"每个文件包含页数"输入框中输入数字（范围：1-1000）
- 默认值为30页
- 例如：输入50表示每50页生成一个XML文件

### 3. 执行拆分

点击"拆分文档"按钮：
- 系统将自动上传文件（如果尚未上传）
- 执行拆分操作
- 显示拆分结果

### 4. 预览拆分结果

拆分完成后，您可以：
- 查看总共生成了多少个XML文件
- 使用左右箭头按钮切换查看不同的XML文件
- 预览窗口显示当前XML的内容（前1000字符）

### 5. 下载文件

提供两种下载方式：

#### 下载当前XML
- 点击"下载当前XML"按钮
- 下载当前正在预览的XML文件
- 文件命名格式：`document_part_N.xml`（N为序号）

#### 打包下载全部XML
- 点击"打包下载全部XML"按钮
- 下载包含所有XML文件的zip压缩包
- 文件命名格式：`document_split_N_parts.zip`（N为文件总数）

## 工作原理

### 分页识别

系统采用两种方式识别页面：

1. **硬分页符识别**
   - 识别Word中的手动分页符（`w:br w:type="page"`）
   - 识别渲染时的分页位置（`w:lastRenderedPageBreak`）

2. **段落估算**（备选方案）
   - 当没有明确分页符时启用
   - 假设每页约40个段落
   - 根据总段落数和设置的页数计算拆分位置

### XML结构保持

每个拆分后的XML文件都保持完整的XML结构：
- 包含XML头部声明
- 包含Word文档的命名空间定义
- 包含完整的`<w:body>`标签
- 保持原始的格式和样式信息

## 示例场景

### 场景1：150页文档拆分为3个文件

```
原始文档：150页的Word文档
设置：每个文件50页
结果：
- document_part_1.xml（第1-50页）
- document_part_2.xml（第51-100页）
- document_part_3.xml（第101-150页）
```

### 场景2：使用默认设置

```
原始文档：100页的Word文档
设置：默认30页
结果：
- document_part_1.xml（第1-30页）
- document_part_2.xml（第31-60页）
- document_part_3.xml（第61-90页）
- document_part_4.xml（第91-100页）
```

## API接口

如果需要通过API调用拆分功能：

### 端点
```
POST /api/files/split-docx
```

### 请求参数
```json
{
  "fileId": "已上传文件的ID",
  "pagesPerFile": 30
}
```

### 响应示例
```json
{
  "success": true,
  "totalChunks": 3,
  "pagesPerFile": 50,
  "chunks": [
    "<?xml version=\"1.0\"...第1个XML内容...",
    "<?xml version=\"1.0\"...第2个XML内容...",
    "<?xml version=\"1.0\"...第3个XML内容..."
  ]
}
```

## 技术实现

### 后端
- `server/utils/docxConverter.ts`
  - `splitDocxXmlByPages()`: 主拆分函数
  - `estimateSplitByParagraphs()`: 段落估算函数
- `server/api/files/split-docx.post.ts`: API端点处理

### 前端
- `pages/main/document-analysis.vue`
  - 拆分UI界面
  - 分页预览功能
  - 下载功能（单个和打包）

### 依赖
- **jszip**: 用于打包下载功能
- **adm-zip**: 用于解析docx文件（docx本质是zip格式）
- **xml2js**: 用于XML解析（可选）

## 注意事项

1. **文件格式**
   - 仅支持.docx格式（Office 2007+）
   - 不支持旧版.doc格式

2. **页数参数**
   - 有效范围：1-1000
   - 建议值：20-100页

3. **内存使用**
   - 大文件拆分可能消耗较多内存
   - 建议单个文档不超过100MB

4. **分页准确性**
   - 包含明确分页符的文档拆分更准确
   - 没有分页符的文档采用估算方式

5. **浏览器兼容性**
   - 打包下载功能需要现代浏览器支持
   - 推荐使用Chrome、Firefox、Edge最新版本

## 故障排除

### 问题：拆分失败
- 检查文件格式是否为.docx
- 检查文件是否损坏
- 尝试减小页数参数

### 问题：预览内容不完整
- 预览窗口仅显示前1000字符
- 下载完整文件查看全部内容

### 问题：打包下载失败
- 确保浏览器允许下载
- 检查是否有足够的磁盘空间
- 尝试单独下载各个文件

## 后续优化建议

1. 支持更多文档格式（PDF、ODT等）
2. 添加文件大小限制和进度条
3. 支持自定义文件命名规则
4. 添加拆分预览（显示每个部分的页码范围）
5. 支持批量拆分多个文档
